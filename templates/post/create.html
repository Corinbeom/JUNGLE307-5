{% extends "base.html" %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/create.css') }}"
/>

{% endblock %} {% block content %}
<div class="post-container">
  <h2>게시물 작성</h2>
  <!-- 게시글 작성 / 수정 form -->
  <form
    id="post-form"
    data-mode="{{ mode }}"
    data-post-id="{{ post.id if post }}"
    action="{{ url_for('create_post') }}"
    method="POST"
    enctype="multipart/form-data"
  >
    {% if mode == 'edit' %}
    <!-- 수정 모드일 때 게시글 ID를 숨겨서 같이 전송 -->
    <input type="hidden" name="post_id" value="{{ post.id }}" />
    {% endif %}

    <div class="form-group">
      <input
        type="text"
        id="title"
        name="title"
        value="{{ post.title if post and post.title }}"
        required
      />
    </div>

    <div class="form-group">
      <label>카테고리</label>
      <label>
        <input type="radio" name="category" value="나눔해요" {% if post and
        post.category == "나눔해요" %}checked{% endif %} /> 나눔해요
      </label>
      <label>
        <input type="radio" name="category" value="필요해요" {% if post and
        post.category == "필요해요" %}checked{% endif %} /> 필요해요
      </label>
    </div>

    <div class="form-group">
      <label for="price">가격</label>
      <input
        type="number"
        id="price"
        name="price"
        min="0"
        value="{{ post.price if post and post.price }}"
      />
      <label>
        <input type="checkbox" id="free-check" {% if post and post.price == 0
        %}checked{% endif %} /> 무료나눔
      </label>
    </div>

    <div class="form-group">
      <label for="description">내용</label>
      <textarea id="description" name="description" required>
{{ post.description if post and post.description }}</textarea
      >
    </div>

    <div class="form-group">
      <label for="image">대표 이미지</label>
      {% if post and post.image_url %}
      <img
        src="{{ post.image_url }}"
        alt="기존 이미지"
        style="max-width: 200px"
      />
      {% endif %}
      <input type="file" id="image" name="image" accept="image/*" />
    </div>

    <button type="submit" class="submit-btn">
      {% if mode == 'edit' %}수정 완료{% else %}작성 완료{% endif %}
    </button>
  </form>
</div>
<script>
  const form = document.getElementById("post-form");
    const mode = form.dataset.mode;
    const postId = form.dataset.postId;

    const url =
      mode === "edit"
        ? `${baseURL}api/posts/${postId}`
        : `${baseURL}api/posts`;

    const method = mode === "edit" ? "patch" : "post";

    // axios 요청 보낼 때
    const res = await axios({
      method: method,
      url: url,
      data: formData,
      headers: {
        "Content-Type": "multipart/form-data",
        // 인증 방식에 따라 추가
        withCredentials: true
      },
    });
</script>
{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='js/postForm.js') }}"></script>
{% endblock %}
