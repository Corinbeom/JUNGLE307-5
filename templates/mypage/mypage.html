{% extends "base.html" %}
{% block title %}마이 페이지{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/mypage.css') }}">

<div class="mypage-container">

    <div class="user-card">
        <img id="profile_image" src="/static/images/jungle.svg" alt="프로필 이미지">
        <div class="post-count">
            <span>게시글 수</span>
            <span id="post_count">{{ post_count }}</span>  <!-- ✅ 서버에서 받은 게시글 수 표시 -->
        </div>
        <div class="user-info">
            <div class="nickname">
                <p>{{ user.lab_name }}</p>
                <p>{{ user.cohort_name }}</p>
            </div>
            <p><strong></strong>{{ user.student_name }}</p>
        </div>
    </div>

    <div class="posts-section">
        <h2>내가 쓴 게시글</h2>
        <table class="post-table">
            <thead>
                <tr>
                    <th>번호</th>
                    <th>제목</th>
                    <th>가격</th>
                    <th>작성일</th>
                    <th>상태</th>
                </tr>
            </thead>
            <tbody>
                {% for post in posts %}
                <tr onclick="goToPostDetail('{{ post.id }}')">
                    <td>{{ post.index }}</td>  <!-- ✅ 순번 표시 -->
                    <td>{{ post.title }}</td>
                    <td>{{ "무료" if post.price == 0 else post.price ~ "원" }}</td>
                    <td>{{ post.created_at }}</td>
                    <td>
                        <form method="PUT" action="{{ url_for('complete_post', post_id=post.id) }}">
                            <button type="submit" {{ "disabled" if post.status == "완료" }}>
                                {{ post.status }}
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<script>
    function goToPostDetail(postId) {
        location.href = `/posts/${postId}`;
    }
</script>

{% endblock %}
